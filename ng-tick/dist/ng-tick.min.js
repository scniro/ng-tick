function init(){angular.module("ngTick",[]).directive("clock",["$filter","tick",function(t,n){return{scope:{format:"@",handle:"@clock",interval:"@",offset:"@",trigger:"="},link:function(o,e,i){o.handle&&(o.$root[o.handle]=o);var r=t("date"),a=n.clock({interval:o.interval,offset:o.offset,onStart:function(t){o.handle&&o.$root[o.handle].$emit(o.handle+":start",t)},onTick:function(t,n){var i=o.format?r(new Date(t),o.format):new Date(t);void 0!==e[0].value?e.val(i):e.text(i),o.handle&&o.$root[o.handle].$emit(o.handle+":tick",n)}});o.start=function(){a.start()},o.stop=function(){a.stop()},o.$on("$destroy",function(){a.stop()}),o.trigger||o.start()}}}]).directive("timer",["$filter","tick",function(t,n){return{scope:{format:"@",handle:"@timer",interval:"@",trigger:"="},link:function(o,e,i){var r={date:t("date"),relative:t("relativeTime")};o.handle&&(o.$root[o.handle]=o);var a=n.timer({onLap:function(t,n,e){o.handle&&o.$root[o.handle].$emit(o.handle+":lap",t,n,e)},onReset:function(t){o.handle&&o.$root[o.handle].$emit(o.handle+":reset",t)},onStart:function(t){o.handle&&o.$root[o.handle].$emit(o.handle+":start",t)},onStop:function(t){o.handle&&o.$root[o.handle].$emit(o.handle+":stop",t)},onTick:function(t){var n=r.relative(t),i=o.format?r.date(n,o.format):n;void 0!==e[0].value?e.val(i):e.text(i)}});o.lap=function(){a.lap()},o.reset=function(){a.reset()},o.start=function(){a.start()},o.stop=function(){a.stop()},o.$on("$destroy",function(){a.stop()}),o.trigger||o.start()}}}]).directive("countdown",["$filter","tick",function(t,n){return{scope:{duration:"=",format:"@",handle:"@countdown",interval:"@",trigger:"="},link:function(o,e,i){var r={date:t("date"),relative:t("relativeTime")};o.handle&&(o.$root[o.handle]=o);var a=n.countdown({onEnd:function(t){o.handle&&o.$root[o.handle].$emit(o.handle+":end",t)},onReset:function(t,n){o.handle&&o.$root[o.handle].$emit(o.handle+":reset",t,n)},onStart:function(t,n){o.handle&&o.$root[o.handle].$emit(o.handle+":start",t,n)},onStop:function(t,n){o.handle&&o.$root[o.handle].$emit(o.handle+":stop",t,n)},onTick:function(t,n,i){var a=r.relative(n),u=o.format?r.date(a,o.format):a;void 0!==e[0].value?e.val(u):e.text(u),o.handle&&o.$root[o.handle].$emit(o.handle+":tick",t,i)}});o.end=function(){a.end()},o.reset=function(){a.reset(o.duration)},o.start=function(){a.start(o.duration)},o.stop=function(){a.stop()},o.$on("$destroy",function(){a.stop()}),o.trigger||o.start()}}}]).filter("relativeTime",[function(){return function(t){return new Date(1970,0,1,0).setMilliseconds(t)}}]).factory("tick",["engine",function(t){function n(n){function o(){i.status().running||(i.start(n.interval),a.onStart(i.status()))}function e(){i.status().running&&i.stop()}n=n||{};var i=new t,r=n.offset?60*(parseInt(n.offset)/100*60+(new Date).getTimezoneOffset())*1e3:0,a=this;return i.on(function(t){var n=Date.now()+r;a.onTick(n,i.status())}),a.onStart=n.onStart||function(){},a.onTick=n.onTick||function(){},{start:o,stop:e}}function o(n){function o(t){for(var n,o=new Date,e=t||{},i=Object.keys(e),r=i.length,a={};r--;)n=i[r],a[n.toLowerCase()]=e[n];var u=a.h||0,s=a.m||0,c=a.s||0,f=a.ms||0;return o.setMilliseconds(o.getMilliseconds()+f),o.setSeconds(o.getSeconds()+c),o.setMinutes(o.getMinutes()+s),o.setHours(o.getHours()+u),Math.abs(o-new Date)}function e(t){var n=parseInt(t%1e3),o=parseInt(t/1e3%60),e=parseInt(t/6e4%60),i=parseInt(t/36e5%24);return i=10>i?0+i:i,e=10>e?0+e:e,o=10>o?0+o:o,{h:i,m:e,s:o,ms:n,percentage:parseFloat((t/c).toFixed(4))}}function i(){s=0,f.stop(),l.onTick(f.status(),0),l.onEnd(f.status())}function r(t){s=o(t)||0,f.stop(),l.onTick(f.status(),s),l.onReset(f.status(),e(s))}function a(t){f.status().running||(c=o(t)||0,s=s>0?s:o(t)||0,f.start(n.interval),l.onStart(f.status(),e(s)))}function u(){f.status().running&&(f.stop(),l.onStop(f.status(),e(s)))}n=n||{};var s,c,f=new t,l=this;return f.on(function(t){s-=t,s>=0?l.onTick(f.status(),s,e(s)):i()}),l.onEnd=n.onEnd||function(){},l.onReset=n.onReset||function(){},l.onStart=n.onStart||function(){},l.onStop=n.onStop||function(){},l.onTick=n.onTick||function(){},{end:i,reset:r,start:a,stop:u}}function e(n){function o(){s.status().running&&(o=!0,u+=1,f.onLap(s.status(),u,c),c=0)}function e(){a=0,s.stop(),f.onTick(a),f.onReset(s.status())}function i(){s.status().running||(a=a>0?a:0,s.start(n.interval),f.onStart(s.status()))}function r(){s.status().running&&(s.stop(),f.onStop(s.status()))}n=n||{};var a,u=0,s=new t,c=0,f=this;return s.on(function(t){a+=t,c+=t,f.onTick(a)}),f.onLap=n.onLap||function(){},f.onReset=n.onReset||function(){},f.onStart=n.onStart||function(){},f.onStop=n.onStop||function(){},f.onTick=n.onTick||function(){},{lap:o,reset:e,start:i,stop:r}}return{clock:function(t){return new n(t)},countdown:function(t){return new o(t)},timer:function(t){return new e(t)}}}]).factory("engine",function(){var t=function(){function t(t){c.on=t||function(){}}function n(t){return a=t?parseInt(t):10,r=Date.now(),s=0,c.running=!0,u=setTimeout(i,a),this}function o(){return{running:c.running,timeoutThread:u}}function e(){clearTimeout(u),c.running=!1}function i(){if(c.running){s+=a,c.on&&c.on(a);var t=Date.now()-r-s;setTimeout(i,a-t)}}var r,a,u,s,c=this;return c.running=!1,{on:t,start:n,status:o,stop:e}};return t})}!function(){"function"==typeof define&&define.amd?define(["angular"],function(){init()}):init()}();